{"version":3,"sources":["webpack:///./src/pages/BusinessOpportunity/detail.vue","webpack:///./src/pages/BusinessOpportunity/detail.vue?6869","webpack:///./src/utils/pulin-login.ts","webpack:///./src/api/BusinessReport.ts","webpack:///./src/pages/BusinessOpportunity/detail.vue?a3a2"],"names":["_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_17","key","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","setup","__props","data","route","houseName","value","houseCode","provinceName","cityName","projectName","id","query","getData","res","login","accessToken","companyCode","path","_ctx","_cache","customerName","customerMobile","intentionDescription","feedbackRecords","item","index","length","title","content","createdTime","__scopeId","getUserInfo","reflesh","setStorage","userInfo","externalUserId","mobile","userId","refreshToken","localStorage","setItem","useLogin","router","getItem","localRefreshToken","fleshUserInfo","Object","assign","replace","redirect","encodeURIComponent","console","log","reportBusiness","url","method","getReferralHistory","referrerMobile","page","size","params","records","result","getReferralFeedbackRecord","referralId","getVisitorByMobile","loadEmployeeSearch"],"mappings":"oMAGA,yBAAa,mBACb,IAAMA,EAA0B,gCAAoB,MAAO,CAAEC,MAAO,SAAW,QAAS,GAClFC,EAAa,CAAED,MAAO,QACtBE,EAAa,CAAEF,MAAO,UACtBG,EAA0B,gCAAoB,MAAO,CAAEH,MAAO,QAAU,MAAO,GAC/EI,EAAa,CAAEJ,MAAO,SACtBK,EAAa,CAAEL,MAAO,UACtBM,EAA0B,gCAAoB,MAAO,CAAEN,MAAO,QAAU,MAAO,GAC/EO,EAAa,CAAEP,MAAO,SACtBQ,EAAa,CAAER,MAAO,UACtBS,EAA2B,gCAAoB,MAAO,CAAET,MAAO,QAAU,MAAO,GAChFU,EAAc,CAAEV,MAAO,SACvBW,EAAc,CAAEX,MAAO,UACvBY,EAA2B,gCAAoB,MAAO,CAAEZ,MAAO,QAAU,QAAS,GAClFa,EAAc,CAAEb,MAAO,SACvBc,EAA2B,gCAAoB,MAAO,CAAEd,MAAO,SAAW,QAAS,GACnFe,EAAc,CAAEf,MAAO,WACvBgB,EAAc,CAClBC,IAAK,EACLjB,MAAO,QAEHkB,EAAc,CAAElB,MAAO,SACvBmB,EAAc,CAAEnB,MAAO,QACvBoB,EAAc,CAAEpB,MAAO,WACvBqB,EAAc,CAAErB,MAAO,QAC7B,0BAOe,mCAAiB,CAC9BsB,MAAA,SAAMC,GAAN,WAEIC,EAAO,iBAA2B,MAClCC,EAAQ,iBACRC,EAAY,uBAAS,W,oBACzB,OAAc,QAAV,EAAAF,EAAKG,aAAK,eAAEC,WACG,QAAV,EAAAJ,EAAKG,aAAK,eAAED,WAGQ,QAAxB,EAAU,QAAV,EAAAF,EAAKG,aAAK,eAAEE,oBAAY,QAAI,KACR,QAApB,EAAU,QAAV,EAAAL,EAAKG,aAAK,eAAEG,gBAAQ,QAAI,KACD,QAAvB,EAAU,QAAV,EAAAN,EAAKG,aAAK,eAAEI,mBAAW,QAAI,OAI5BC,EAAKP,EAAMQ,MAAMD,GACjBE,EAAU,SAAOF,GAAU,kD,qEACnB,SAAM,eAA0BA,I,cAAtCG,EAAM,SACZX,EAAKG,MAAQQ,E,YAGTC,EAAQ,6D,+DACZ,SAAM,eACJX,EAAMQ,MAAMI,YACZZ,EAAMQ,MAAMK,YACXb,EAAMc,KAAO,OAASP,I,cAHzB,SAKAE,GAASF,G,YAIX,OAFAI,IAEO,SAACI,EAAUC,G,YAChB,OAAQ,yBAAc,gCAAoB,cAAW,KAAM,CACzD1C,EACA,gCAAoB,MAAOE,EAAY,CACrC,gCAAoB,MAAOC,EAAY,CACrCC,EACA,gCAAoB,MAAOC,EAAY,6BAA2B,QAAV,EAAAoB,EAAKG,aAAK,eAAEe,cAAe,KAErF,gCAAoB,MAAOrC,EAAY,CACrCC,EACA,gCAAoB,MAAOC,EAAY,6BAAiB,mBAAOmB,IAAa,KAE9E,gCAAoB,MAAOlB,EAAY,CACrCC,EACA,gCAAoB,MAAOC,EAAa,6BAA2B,QAAV,EAAAc,EAAKG,aAAK,eAAEgB,gBAAiB,KAExF,gCAAoB,MAAOhC,EAAa,CACtCC,EACA,gCAAoB,MAAOC,EAAa,6BAA2B,QAAV,EAAAW,EAAKG,aAAK,eAAEiB,sBAAuB,OAGhG9B,EACA,gCAAoB,MAAOC,EAAa,EACrC,wBAAW,GAAO,gCAAoB,cAAW,KAAM,wBAAsB,QAAV,EAAAS,EAAKG,aAAK,eAAEkB,iBAAiB,SAACC,EAAMC,G,MACtG,OAAQ,yBAAc,gCAAoB,MAAO,CAC/C/C,MAAO,MACPiB,IAAK8B,GACJ,CACAA,EAAQ,KAAgB,QAAV,EAAAvB,EAAKG,aAAK,eAAEkB,gBAAgBG,SACtC,yBAAc,gCAAoB,MAAOhC,IAC1C,gCAAoB,IAAI,GAC5B,gCAAoB,MAAO,CACzBhB,MAAO,4BAA0B,IAAV+C,EAAc,SAAW,eAC/C,KAAM,GACT,gCAAoB,MAAO7B,EAAa,CACtC,gCAAoB,MAAOC,EAAa,6BAAiB2B,EAAKG,OAAQ,GACtE,gCAAoB,MAAO7B,EAAa,6BAAiB0B,EAAKI,SAAU,GACxE,gCAAoB,MAAO7B,EAAa,6BAAiByB,EAAKK,aAAc,UAG9E,SAEL,Q,UCzGL,EAAOC,UAAY,kBAEJ,gB,6LCFTC,EAAc,SAAOhB,EAAqBC,GAAmB,uD,qEACrD,SAAM,eAAmBD,EAAaC,I,OAClD,OADMH,EAAM,SACZ,GAAOA,WAIHmB,EAAU,SAAO9B,GAAY,uD,qEACrB,SAAM,eAAaA,I,OAC/B,OADMW,EAAM,SACZ,GAAOA,WAYIoB,EAAa,SAACC,GACjB,IAAAC,EAA8DD,EAAhD,eAAEE,EAA8CF,EAAxC,OAAEG,EAAsCH,EAAhC,OAAEnB,EAA8BmB,EAAnB,YAAEI,EAAiBJ,EAAL,aACjEC,GAAkBI,aAAaC,QAAQ,iBAAkBL,GACzDC,GAAUG,aAAaC,QAAQ,SAAUJ,GACzCC,GAAUE,aAAaC,QAAQ,SAAUH,GACzCtB,GAAewB,aAAaC,QAAQ,eAAgBzB,GACpDuB,GAAgBC,aAAaC,QAAQ,eAAgBF,IAI1CG,EAAW,SAAO1B,EAAqBC,EAAqBC,GAAY,uD,iFACnF,OAAKF,GAAgBC,GACf0B,EAAS,iBACE,GAAMX,EAAYhB,EAAaC,KAFP,CAAP,GAAO,G,UAEnCkB,EAAW,SACjBD,EAAWC,GAEXK,aAAaC,QAAQ,cAAexB,GACpCuB,aAAaC,QAAQ,cAAezB,GAE9BqB,EAASG,aAAaI,QAAQ,UAC9BN,EAASE,aAAaI,QAAQ,UAC9BR,EAAiBI,aAAaI,QAAQ,kBACtCC,EAAoBL,aAAaI,QAAQ,kBAE3CT,EAASE,SAAWA,GAAUD,GAAkBS,GAAqBP,GAArE,Y,iBAGsB,O,sBAAA,GAAML,EAAQ,CAClCG,eAAc,EACdE,OAAM,EACNC,aAAcM,K,cAHVC,EAAgB,SAKtBZ,EAAWa,OAAOC,OAAOF,EAAe,CAAET,OAAM,K,6BAGhDM,EAAOM,QAAQ,CACb/B,KAAM,gBACNN,MAAO,CACLyB,OAAQF,EAASE,OACjBa,SAAUC,mBAAmBjC,M,gCAMnCkC,QAAQC,IAAI,gBAAiBV,GAE7BA,EAAOM,QAAQ,CACb/B,KAAM,gBACNN,MAAO,CACLyB,OAAQF,EAASE,OACjBa,SAAUC,mBAAmBjC,M,iBAInC,UAAO,Y,oPClDIoC,EAAiB,SAACnD,GAC7B,OAAO,eAAQ,CACboD,IAAQ,OAAqB,gBAC7BC,OAAQ,OACRrD,KAAI,KAgBKsD,EAAqB,SAChCC,EACAC,G,YAAA,IAAAA,MAAA,CAAeA,KAAM,EAAGC,KAAM,K,uHAElB,SAAM,eAAQ,CACxBL,IAAQ,OAAqB,iBAAiBG,EAC9CF,OAAQ,MACRK,OAAQ,OAAF,OAAE,CAAF,GAAOF,M,OAGf,OANM7C,EAAM,SAKNgD,EAA6BhD,EAAIiD,OAAOD,QAC9C,GAAOA,WAWIE,EAA4B,SAAOC,GAAkB,uD,uEACpD,SAAM,eAAQ,CACxBV,IAAQ,OAAqB,2BAA2BU,EACxDT,OAAQ,S,OAGV,OALM1C,EAAM,SAINgD,EAA0BhD,EAAIiD,OACpC,GAAOD,WAaII,EAAqB,SAAO7B,GAAc,uD,uEACzC,SAAM,eAAQ,CACxBkB,IAAQ,OAAqB,kCAC7BC,OAAQ,MACRK,OAAQ,CAAExB,OAAM,M,OAGlB,OANMvB,EAAM,SAKNiD,EAA8BjD,EAAIiD,OACxC,GAAOA,WAsBII,EAAqB,SAAOhE,GAAa,uD,uEACxC,SAAM,eAAQ,CACxBoD,IAAQ,OAAwB,4BAChCC,OAAQ,OACRrD,KAAI,K,OAGN,OANMW,EAAM,SAKNiD,EAA2BjD,EAAIiD,OACrC,GAAOA,Y,kCC7HT","file":"js/BusinessOpportunityDetail.064a866a.js","sourcesContent":["import { defineComponent as _defineComponent } from 'vue'\nimport { createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, unref as _unref, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, normalizeClass as _normalizeClass, withScopeId as _withScopeId, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\"\n\n_pushScopeId(\"data-v-66d750d7\")\nconst _hoisted_1 = /*#__PURE__*/_createElementVNode(\"div\", { class: \"title\" }, \"基本信息\", -1)\nconst _hoisted_2 = { class: \"body\" }\nconst _hoisted_3 = { class: \"pancel\" }\nconst _hoisted_4 = /*#__PURE__*/_createElementVNode(\"div\", { class: \"left\" }, \"客户\", -1)\nconst _hoisted_5 = { class: \"right\" }\nconst _hoisted_6 = { class: \"pancel\" }\nconst _hoisted_7 = /*#__PURE__*/_createElementVNode(\"div\", { class: \"left\" }, \"房屋\", -1)\nconst _hoisted_8 = { class: \"right\" }\nconst _hoisted_9 = { class: \"pancel\" }\nconst _hoisted_10 = /*#__PURE__*/_createElementVNode(\"div\", { class: \"left\" }, \"手机\", -1)\nconst _hoisted_11 = { class: \"right\" }\nconst _hoisted_12 = { class: \"pancel\" }\nconst _hoisted_13 = /*#__PURE__*/_createElementVNode(\"div\", { class: \"left\" }, \"意向描述\", -1)\nconst _hoisted_14 = { class: \"right\" }\nconst _hoisted_15 = /*#__PURE__*/_createElementVNode(\"div\", { class: \"title\" }, \"转介进度\", -1)\nconst _hoisted_16 = { class: \"process\" }\nconst _hoisted_17 = {\n  key: 0,\n  class: \"line\"\n}\nconst _hoisted_18 = { class: \"right\" }\nconst _hoisted_19 = { class: \"name\" }\nconst _hoisted_20 = { class: \"content\" }\nconst _hoisted_21 = { class: \"time\" }\n_popScopeId()\n\nimport { computed, ref } from 'vue'\nimport { useRoute } from 'vue-router'\nimport { getReferralFeedbackRecord, FeedbackRecord } from '@/api/BusinessReport'\nimport { useLogin } from '@/utils/pulin-login'\n\nexport default _defineComponent({\n  setup(__props) {\n\nconst data = ref<FeedbackRecord | null>(null)\nconst route = useRoute()\nconst houseName = computed(() => {\n  if (data.value?.houseCode) {\n    return data.value?.houseName\n  } else {\n    return (\n      (data.value?.provinceName ?? '') +\n      (data.value?.cityName ?? '') +\n      (data.value?.projectName ?? '')\n    )\n  }\n})\nconst id = route.query.id as string\nconst getData = async (id: number) => {\n  const res = await getReferralFeedbackRecord(id)\n  data.value = res\n}\n\nconst login = async () => {\n  await useLogin(\n    route.query.accessToken as string,\n    route.query.companyCode as string,\n    (route.path + '?id=' + id) as string\n  )\n  getData(+id)\n}\nlogin()\n\nreturn (_ctx: any,_cache: any) => {\n  return (_openBlock(), _createElementBlock(_Fragment, null, [\n    _hoisted_1,\n    _createElementVNode(\"div\", _hoisted_2, [\n      _createElementVNode(\"div\", _hoisted_3, [\n        _hoisted_4,\n        _createElementVNode(\"div\", _hoisted_5, _toDisplayString(data.value?.customerName), 1)\n      ]),\n      _createElementVNode(\"div\", _hoisted_6, [\n        _hoisted_7,\n        _createElementVNode(\"div\", _hoisted_8, _toDisplayString(_unref(houseName)), 1)\n      ]),\n      _createElementVNode(\"div\", _hoisted_9, [\n        _hoisted_10,\n        _createElementVNode(\"div\", _hoisted_11, _toDisplayString(data.value?.customerMobile), 1)\n      ]),\n      _createElementVNode(\"div\", _hoisted_12, [\n        _hoisted_13,\n        _createElementVNode(\"div\", _hoisted_14, _toDisplayString(data.value?.intentionDescription), 1)\n      ])\n    ]),\n    _hoisted_15,\n    _createElementVNode(\"div\", _hoisted_16, [\n      (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(data.value?.feedbackRecords, (item, index) => {\n        return (_openBlock(), _createElementBlock(\"div\", {\n          class: \"box\",\n          key: index\n        }, [\n          (index + 1 !== data.value?.feedbackRecords.length)\n            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_17))\n            : _createCommentVNode(\"\", true),\n          _createElementVNode(\"div\", {\n            class: _normalizeClass(index === 0 ? 'circle' : 'darkCircle')\n          }, null, 2),\n          _createElementVNode(\"div\", _hoisted_18, [\n            _createElementVNode(\"div\", _hoisted_19, _toDisplayString(item.title), 1),\n            _createElementVNode(\"div\", _hoisted_20, _toDisplayString(item.content), 1),\n            _createElementVNode(\"div\", _hoisted_21, _toDisplayString(item.createdTime), 1)\n          ])\n        ]))\n      }), 128))\n    ])\n  ], 64))\n}\n}\n\n})","import script from \"./detail.vue?vue&type=script&lang=ts&setup=true\"\nexport * from \"./detail.vue?vue&type=script&lang=ts&setup=true\"\n\nimport \"./detail.vue?vue&type=style&index=0&id=66d750d7&lang=scss&scoped=true\"\nscript.__scopeId = \"data-v-66d750d7\"\n\nexport default script","import { getUserInfoByToken, refreshToken } from '@/api/user'\nimport { useRouter } from 'vue-router'\n\n// 根据朴邻token查询用户信息\nconst getUserInfo = async (accessToken: string, companyCode: string) => {\n  const res = await getUserInfoByToken(accessToken, companyCode)\n  return res\n}\n\n// 刷新token\nconst reflesh = async (data: object) => {\n  const res = await refreshToken(data)\n  return res\n}\n\ninterface TokenUserInfo {\n  externalUserId: string\n  mobile: string\n  userId: string\n  accessToken: string\n  refreshToken: string\n}\n\n// 设置storage\nexport const setStorage = (userInfo: TokenUserInfo) => {\n  const { externalUserId, mobile, userId, accessToken, refreshToken } = userInfo\n  externalUserId && localStorage.setItem('externalUserId', externalUserId)\n  mobile && localStorage.setItem('mobile', mobile)\n  userId && localStorage.setItem('userId', userId)\n  accessToken && localStorage.setItem('access_token', accessToken)\n  refreshToken && localStorage.setItem('refreshToken', refreshToken)\n}\n\n// 朴邻跳转登录逻辑\nexport const useLogin = async (accessToken: string, companyCode: string, path: string) => {\n  if (!accessToken || !companyCode) return false\n  const router = useRouter()\n  const userInfo = await getUserInfo(accessToken, companyCode)\n  setStorage(userInfo)\n  // 保存朴邻的token和companyCode\n  localStorage.setItem('companyCode', companyCode)\n  localStorage.setItem('pulin_token', accessToken)\n  // // 本地保存的数据 --- 可用于刷新token\n  const mobile = localStorage.getItem('mobile') as string\n  const userId = localStorage.getItem('userId') as string\n  const externalUserId = localStorage.getItem('externalUserId') as string\n  const localRefreshToken = localStorage.getItem('refreshToken') as string\n  // 校验手机号和本地一致并且刷新token所需数据存在，执行刷新token操作\n  if (userInfo.mobile === mobile && externalUserId && localRefreshToken && userId) {\n    try {\n      // 刷新token\n      const fleshUserInfo = await reflesh({\n        externalUserId,\n        userId,\n        refreshToken: localRefreshToken\n      })\n      setStorage(Object.assign(fleshUserInfo, { mobile }))\n    } catch (error) {\n      // 刷新token失败去登录\n      router.replace({\n        path: '/mobile-login',\n        query: {\n          mobile: userInfo.mobile,\n          redirect: encodeURIComponent(path)\n        }\n      })\n    }\n  } else {\n    // 否则去登录\n    console.log('useRouter(): ', router)\n    // 去手机验证码登录页\n    router.replace({\n      path: '/mobile-login',\n      query: {\n        mobile: userInfo.mobile,\n        redirect: encodeURIComponent(path)\n      }\n    })\n  }\n  return true\n}\n","import * as url from './url'\nimport request from '@/utils/request'\nexport interface Business {\n  referrerMobile: string\n  intentionDescription: string\n  customerName: string\n  customerMobile: string\n  provinceCode?: string\n  provinceName?: string\n  cityCode?: string\n  cityName?: string\n  projectCode?: string\n  projectName?: string\n  buildingCode?: string\n  buildingName?: string\n  houseCode?: string\n  assistContactsPhone?: string\n  assistContactsName?: string\n  intentionType?: string\n  recommendPerName?: string\n  recommendPerPhone?: string\n  referralSource?: string\n  fromAppId?: number\n  companyCode?: string\n}\ninterface Page {\n  page: number\n  size: number\n}\nexport const reportBusiness = (data: Business) => {\n  return request({\n    url: `${url.VUE_APP_DIANA_URL}/api/referral`,\n    method: 'POST',\n    data\n  })\n}\n\ninterface ReferralHistory {\n  houseName: string\n  feedbackMessage: string\n  customerName: string\n  customerMobile: string\n  cityName: string\n  projectName: string\n  provinceName: string\n  id: number\n  houseCode: string\n}\n\nexport const getReferralHistory = async (\n  referrerMobile: string,\n  page: Page = { page: 1, size: 10 }\n) => {\n  const res = await request({\n    url: `${url.VUE_APP_DIANA_URL}/api/referral/${referrerMobile}`,\n    method: 'get',\n    params: { ...page }\n  })\n  const records: ReferralHistory[] = res.result.records\n  return records\n}\ninterface ProcessRecord {\n  title: string\n  content: string\n  createdTime: string\n}\nexport interface FeedbackRecord extends ReferralHistory {\n  feedbackRecords: ProcessRecord[]\n  intentionDescription: string\n}\nexport const getReferralFeedbackRecord = async (referralId: number) => {\n  const res = await request({\n    url: `${url.VUE_APP_DIANA_URL}/referralFeedbackRecord/${referralId}`,\n    method: 'get'\n  })\n  const records: FeedbackRecord = res.result\n  return records\n}\n\ninterface VisitorByMobileType {\n  externalUserId: string\n  nickname: string\n  id: string\n  mobile: string\n  name: string\n  source: string\n  avatar: string\n}\n// 根据手机号查询访客\nexport const getVisitorByMobile = async (mobile: string) => {\n  const res = await request({\n    url: `${url.VUE_APP_DIANA_URL}/api/visitor/getVisitorByMobile`,\n    method: 'get',\n    params: { mobile }\n  })\n  const result: VisitorByMobileType = res.result\n  return result\n}\n\ninterface ISEARCH {\n  nameOrMobile: string\n  pageSize: number\n  pageNo: number\n}\ninterface IEMPLOYEERELIST {\n  name: string\n  positionCode: string\n  positionName: string\n  mobile: string\n  organization: string\n  organizationName: string\n}\ninterface IEMPLOYEEREESULT {\n  current: number\n  pages: number\n  records: IEMPLOYEERELIST[]\n}\n// 获取员工信息，推荐人列表\nexport const loadEmployeeSearch = async (data: ISEARCH) => {\n  const res = await request({\n    url: `${url.VUE_APP_BLACKSAM_URL}/frontend/employee/search`,\n    method: 'POST',\n    data\n  })\n  const result: IEMPLOYEEREESULT = res.result\n  return result\n}\n","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./detail.vue?vue&type=style&index=0&id=66d750d7&lang=scss&scoped=true\""],"sourceRoot":""}