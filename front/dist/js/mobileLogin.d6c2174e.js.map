{"version":3,"sources":["webpack:///./src/utils/pulin-login.ts","webpack:///./src/pages/mobile-login.vue","webpack:///./src/pages/mobile-login.vue?a4d3","webpack:///./src/pages/mobile-login.vue?1ab1"],"names":["getUserInfo","accessToken","companyCode","getUserInfoByToken","res","_a","reflesh","data","refreshToken","setStorage","userInfo","externalUserId","mobile","userId","localStorage","setItem","useLogin","path","router","useRouter","getItem","localRefreshToken","fleshUserInfo","Object","assign","replace","query","redirect","encodeURIComponent","console","log","_pushScopeId","_hoisted_1","class","_hoisted_2","_createElementVNode","_hoisted_3","_hoisted_4","_hoisted_5","_popScopeId","_defineComponent","setup","__props","route","useRoute","phone","ref","code","codeSent","seconds","sendCode","value","getVerifyCode","message","Toast","countDown","timer","setInterval","clearInterval","login","loginByVerifyCode","verifyCode","decodeURIComponent","onBeforeUnmount","_ctx","_cache","_component_van_field","_resolveComponent","_openBlock","_createElementBlock","_createVNode","modelValue","$event","modelModifiers","trim","label","type","placeholder","maxlength","_normalizeClass","active","onClick","_toDisplayString","length","__exports__"],"mappings":"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","file":"js/mobileLogin.d6c2174e.js","sourcesContent":["import { getUserInfoByToken, refreshToken } from '@/api/user'\nimport { useRouter } from 'vue-router'\n\n// 根据朴邻token查询用户信息\nconst getUserInfo = async (accessToken: string, companyCode: string) => {\n  const res = await getUserInfoByToken(accessToken, companyCode)\n  return res\n}\n\n// 刷新token\nconst reflesh = async (data: object) => {\n  const res = await refreshToken(data)\n  return res\n}\n\ninterface TokenUserInfo {\n  externalUserId: string\n  mobile: string\n  userId: string\n  accessToken: string\n  refreshToken: string\n}\n\n// 设置storage\nexport const setStorage = (userInfo: TokenUserInfo) => {\n  const { externalUserId, mobile, userId, accessToken, refreshToken } = userInfo\n  externalUserId && localStorage.setItem('externalUserId', externalUserId)\n  mobile && localStorage.setItem('mobile', mobile)\n  userId && localStorage.setItem('userId', userId)\n  accessToken && localStorage.setItem('access_token', accessToken)\n  refreshToken && localStorage.setItem('refreshToken', refreshToken)\n}\n\n// 朴邻跳转登录逻辑\nexport const useLogin = async (accessToken: string, companyCode: string, path: string) => {\n  if (!accessToken || !companyCode) return false\n  const router = useRouter()\n  const userInfo = await getUserInfo(accessToken, companyCode)\n  setStorage(userInfo)\n  // 保存朴邻的token和companyCode\n  localStorage.setItem('companyCode', companyCode)\n  localStorage.setItem('pulin_token', accessToken)\n  // // 本地保存的数据 --- 可用于刷新token\n  const mobile = localStorage.getItem('mobile') as string\n  const userId = localStorage.getItem('userId') as string\n  const externalUserId = localStorage.getItem('externalUserId') as string\n  const localRefreshToken = localStorage.getItem('refreshToken') as string\n  // 校验手机号和本地一致并且刷新token所需数据存在，执行刷新token操作\n  if (userInfo.mobile === mobile && externalUserId && localRefreshToken && userId) {\n    try {\n      // 刷新token\n      const fleshUserInfo = await reflesh({\n        externalUserId,\n        userId,\n        refreshToken: localRefreshToken\n      })\n      setStorage(Object.assign(fleshUserInfo, { mobile }))\n    } catch (error) {\n      // 刷新token失败去登录\n      router.replace({\n        path: '/mobile-login',\n        query: {\n          mobile: userInfo.mobile,\n          redirect: encodeURIComponent(path)\n        }\n      })\n    }\n  } else {\n    // 否则去登录\n    console.log('useRouter(): ', router)\n    // 去手机验证码登录页\n    router.replace({\n      path: '/mobile-login',\n      query: {\n        mobile: userInfo.mobile,\n        redirect: encodeURIComponent(path)\n      }\n    })\n  }\n  return true\n}\n","import { defineComponent as _defineComponent } from 'vue'\nimport { createElementVNode as _createElementVNode, resolveComponent as _resolveComponent, createVNode as _createVNode, toDisplayString as _toDisplayString, normalizeClass as _normalizeClass, openBlock as _openBlock, createElementBlock as _createElementBlock, withScopeId as _withScopeId, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\"\n\n_pushScopeId(\"data-v-3124f26b\")\nconst _hoisted_1 = { class: \"login\" }\nconst _hoisted_2 = /*#__PURE__*/_createElementVNode(\"div\", { class: \"title\" }, \"验证码登录\", -1)\nconst _hoisted_3 = { class: \"con\" }\nconst _hoisted_4 = { class: \"input-box\" }\nconst _hoisted_5 = { class: \"input-box code\" }\n_popScopeId()\n\nimport { onBeforeUnmount, ref } from 'vue'\nimport { useRoute, useRouter } from 'vue-router'\nimport { getVerifyCode, loginByVerifyCode } from '@/api/user'\nimport { setStorage } from '@/utils/pulin-login'\nimport { Toast } from 'vant'\n\nexport default _defineComponent({\n  setup(__props) {\n\nconst router = useRouter()\nconst route = useRoute()\n// 手机号\nconst phone = ref('18289755297')\n// 输入的验证码\nconst code = ref('123')\n// 获取验证码\n// 是否发送\nconst codeSent = ref(false)\n// 倒计时秒数\nconst seconds = ref(60)\n// 点击发送\nconst sendCode = async () => {\n  // 已发送不操作\n  if (codeSent.value) return\n  const res = await getVerifyCode(phone.value)\n  console.log(res)\n  code.value = res.message\n  Toast('验证码已发送')\n  codeSent.value = true\n  countDown()\n}\n// 倒计时\nlet timer: number = 0\nconst countDown = () => {\n  seconds.value = 60\n  timer = setInterval(() => {\n    if (seconds.value > 0) seconds.value--\n    else {\n      clearInterval(timer)\n      timer = 0\n      codeSent.value = false\n    }\n  }, 1000)\n}\n\n// 登录/注册\nconst login = async () => {\n  const userInfo = await loginByVerifyCode({\n    phone: phone.value,\n    verifyCode: code.value\n    // userId: localStorage.getItem('userId')\n    // externalUserId: localStorage.getItem('externalUserId')\n  })\n  console.log(userInfo)\n  if (userInfo.phone) {\n    setStorage(userInfo)\n    router.replace('/index')\n  }\n  console.log(localStorage.getItem('access_token'), 'getItem')\n  console.log(decodeURIComponent(route.query.redirect as string))\n  // const path = decodeURIComponent(route.query.redirect as string)\n  // router.replace(path + (path.includes('?') ? '&' : '?') + 'isPulin=1')\n}\n// 页面卸载，清除定时器\nonBeforeUnmount(() => {\n  timer && clearInterval(timer)\n})\n\nreturn (_ctx: any,_cache: any) => {\n  const _component_van_field = _resolveComponent(\"van-field\")!\n\n  return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n    _hoisted_2,\n    _createElementVNode(\"div\", _hoisted_3, [\n      _createElementVNode(\"div\", _hoisted_4, [\n        _createVNode(_component_van_field, {\n          modelValue: phone.value,\n          \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event: any) => (phone.value = $event)),\n          modelModifiers: { trim: true },\n          label: \"\",\n          type: \"tel\",\n          placeholder: \"请输入手机号\",\n          maxlength: 11\n        }, null, 8, [\"modelValue\"])\n      ]),\n      _createElementVNode(\"div\", _hoisted_5, [\n        _createVNode(_component_van_field, {\n          modelValue: code.value,\n          \"onUpdate:modelValue\": _cache[1] || (_cache[1] = ($event: any) => (code.value = $event)),\n          modelModifiers: { trim: true },\n          label: \"\",\n          type: \"tel\",\n          placeholder: \"请输入验证码\",\n          maxlength: 6\n        }, null, 8, [\"modelValue\"]),\n        _createElementVNode(\"div\", {\n          class: _normalizeClass([\"code-btn\", { active: !codeSent.value }]),\n          onClick: sendCode\n        }, _toDisplayString(codeSent.value ? seconds.value + 's后重新获取' : '获取验证码'), 3)\n      ]),\n      _createElementVNode(\"div\", {\n        class: _normalizeClass([\"btn-wrap\", { 'active-login': code.value.length > 3 }]),\n        onClick: login\n      }, \" 登录 \", 2)\n    ])\n  ]))\n}\n}\n\n})","import script from \"./mobile-login.vue?vue&type=script&lang=ts&setup=true\"\nexport * from \"./mobile-login.vue?vue&type=script&lang=ts&setup=true\"\n\nimport \"./mobile-login.vue?vue&type=style&index=0&id=3124f26b&lang=scss&scoped=true\"\n\nimport exportComponent from \"/Users/aleeeeex/Desktop/web3/Start-ups/nftgogo/front/node_modules/vue-loader-v16/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-3124f26b\"]])\n\nexport default __exports__","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./mobile-login.vue?vue&type=style&index=0&id=3124f26b&lang=scss&scoped=true\""],"sourceRoot":""}