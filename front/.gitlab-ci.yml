## ä½¿ç”¨è¯´æ˜ï¼š https://git.vankeservice.com/pulin/backend/k8s-config/gitlab-ci-templates
include:
  - project: 'renz-public/gitlab-ci-templates'
    ref: master
    file: '.gitlab-ci-template.yml'

## å®šä¹‰å˜é‡, ä¾›åé¢çš„ä»»åŠ¡ä½¿ç”¨, è¯·ä»”ç»†æ ¸å¯¹
variables:
  PROD_BRANCH: master ## é€‰å¡«
  ## æµ‹è¯•ç¯å¢ƒåˆ†æ”¯, é»˜è®¤æ˜¯masteråˆ†æ”¯
  TEST_BRANCH: test ## é€‰å¡«

  TEST_WECHAT_KEY: '493ff754-ea92-4094-8df2-9efac98f627d' ## é€‰å¡«,ä¸å¡«ä½¿ç”¨é»˜è®¤æœºå™¨äºº
  PROD_WECHAT_KEY: 'afc09182-179a-4968-b8b2-59390b676dc9' ## é€‰å¡«,ä¸å¡«ä½¿ç”¨é»˜è®¤æœºå™¨äºº
  WECHAT_BODY: "{\"msgtype\": \"markdown\",\"markdown\":{\"content\": \"H5å°é¡¹ç›®æ„å»ºğŸš€ï¼Œè¯·ç›¸å…³åŒäº‹æ³¨æ„ã€‚\n>[ä»£ç åœ°å€]($CI_PROJECT_URL) \n>[å‰ç«¯åœ°å€](https://katarian-test.4009515151.com) \n>[pipelineåœ°å€]($CI_PIPELINE_URL) \n>æœ¬æ¬¡æ„å»ºç”±ï¼š$GITLAB_USER_NAME è§¦å‘ \n>æäº¤commit: $CI_COMMIT_SHORT_SHA \n>æ„å»ºåˆ†æ”¯ï¼š$CI_COMMIT_REF_NAME \n>æäº¤æ—¥å¿—ï¼š$CI_COMMIT_MESSAGE \n>[ğŸ—ºå‘ç‰ˆ(ç¯å¢ƒ)å†å²]($CI_PROJECT_URL/environments)\" }}"
  GROUP: weijia
  # k8s ctx
  TEST_CTX: weijia-test
  PROD_CTX: weijia-prod

## ç”¨æ¥ç¼“å­˜artifactory, éœ€è¦é…ç½®æ­£ç¡®è·¯å¾„, ä¾‹å¦‚java mavenç¼–è¯‘ç”Ÿæˆçš„æ–‡ä»¶
## æŠŠä¸‹è¡Œçš„ "." å»æ‰å¯ä»¥å¼€å¯
cache:
  paths:
    - example-service/target
    - node_modules/

# ç”Ÿæˆchangelog
release:
  image: node:14.18.2
  stage: docker-build
  script:
    - yarn
    - npx semantic-release
  only:
    - master
  tags:
    - docker
